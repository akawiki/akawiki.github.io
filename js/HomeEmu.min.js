function Init(){var n;for(g_MQuartz=0,g_MQuartzLv=0,g_Quartz=new Array(g_SlotCount),g_QuartzPlus=new Array(g_SlotCount),n=0;n<g_SlotCount;++n)g_Quartz[n]=0,g_QuartzPlus[n]=0;for(g_Weapon=0,g_WeaponPlus=0,g_Armor=0,g_ArmorPlus=0,g_Acc=0,g_EnhWeapon=0,g_EnhArmor=0,g_CharRank=6,g_CharClo=0,g_CharLv=40,g_CurArt=new Array(g_art.length),g_CurAV=new Array(g_art.length*3),n=0;n<g_art.length*3;++n)g_CurAV[n]=0;for(g_CurLine=[],n=0;n<g_SlotCount;++n)g_CurLine.push([0,0,0,0,0,0,0]);for(g_PrevMQuartz=0,g_PrevMQuartzLv=0,g_PrevQuartz=new Array(g_SlotCount),g_PrevQuartzPlus=new Array(g_SlotCount),n=0;n<g_SlotCount;++n)g_PrevQuartz[n]=0,g_PrevQuartzPlus[n]=0;g_PrevCurArt=new Array(g_art.length);g_PrevCurArtAdd=new Array(g_art.length);g_PrevCurArtRemove=new Array(g_art.length);g_PrevWeapon=0;g_PrevWeaponPlus=0;g_PrevArmor=0;g_PrevArmorPlus=0;g_PrevAcc=0;g_PrevEnhWeapon=0;g_PrevEnhArmor=0;g_PrevCharRank=0;g_PrevCharLv=0;g_PrevCharClo=0;g_SlotCur=-1}function InitArt(){for(var t,o=$("#divArt"),n="",r=0;r<g_art.length*3;++r){var u=r%g_art.length,i=g_art[u],f=g_artn[u],e=r/g_art.length|0;for(n+='<a class="list-group-item list-group-item-small small hidden" data-index="'+u+'"><div class="row" style="display: flex;"><div class="col-xs-5" style="padding-left: 4px;"><span class="qrzs'+i.type+'"><\/span>',n+=0==e?'<span class="label-success">':1==e?'<span class="label-danger">':1==i.att?'<span class="art-att">':'<span class="art-aux">',n+=i.namej,f.namen.length>0&&(n+="("+f.namen+")"),n+="<\/span>",n+='<\/div><div class="col-xs-5 text-right no-padding">',t=0;t<7;++t)i.elem[t]>0&&(n+='<span class="art-orb orbis'+t+'"><\/span><span class="orb'+t+'">'+i.elem[t]+"<\/span>");n+='<\/div><div class="col-xs-2 text-right" style="padding-right: 4px; padding-left: 0;">'+i.ep;n+=" EP<\/div><\/div><\/a>"}o.html(n)}function InitArtAll(){for(var i,e=$("#tblArt"),f="",u=0;u<g_art.length;++u){var t=g_art[u],r=g_artn[u],n='<tr><td class="text-nowrap"><span class="qrzs'+t.type+'"><\/span><span class="';for(n+=1==t.att?"art-att":"art-aux",n+='">',n+=t.namej,r.namen.length>0&&(n+="("+r.namen+")"),n+="<\/span><\/td>",n+='<td class="text-nowrap">',i=0;i<7;++i)t.elem[i]>0&&(n+='<span class="art-orb orbis'+i+'"><\/span><span class="orb'+i+'">'+t.elem[i]+"<\/span>");n+="<\/td>";n+="<td>"+t.ep+"<\/td>";n+="<td>"+(t.pwr>0?t.pwr:"")+"<\/td>";n+="<td>"+t.drv+"<\/td>";n+="<td>"+t.dly+"<\/td>";n+="<td>"+r.range+"<\/td>";n+="<td>"+r.eff+"<\/td>";r.desc.length>0&&(n+='<td><span data-toggle="tooltip" data-placement="left" title="'+r.desc+'"><span class="glyphicon glyphicon-comment text-success"><\/span><\/span><\/td>');n+="<\/tr>";f+=n}e.html(f);$("body").tooltip({selector:'[data-toggle="tooltip"]',html:!0})}function ClearSlot(){g_MQuartz=0;g_MQuartzLv=0;for(var n=0;n<g_SlotCount;++n)g_Quartz[n]=0,g_QuartzPlus[n]=0;g_Weapon=0;g_WeaponPlus=0;g_Armor=0;g_ArmorPlus=0;g_Acc=0;g_EnhWeapon=0;g_EnhArmor=0;g_CharRank=6;g_CharClo=0;g_CharLv=40}function EncodeUrl(){for(var i=new ArrayBuffer(36),u=new Uint16Array(i,0,7),t=new Uint8Array(i,14,10),r=new Uint32Array(i,24,3),n=0;n<g_SlotCount;++n)u[n]=g_Quartz[n];for(n=0;n<g_SlotCount;n+=2)t[n>>1]=g_QuartzPlus[n]<<4|g_QuartzPlus[n+1];return u[g_SlotCount]=g_CharId,t[3]=g_MQuartz,t[4]=g_MQuartzLv,t[5]=g_WeaponPlus<<4|g_ArmorPlus,t[6]=g_EnhWeapon,t[7]=g_EnhArmor,t[8]=g_CharRank|g_CharClo<<4,t[9]=g_CharLv,r[0]=g_Weapon,r[1]=g_Armor,r[2]=g_Acc,escape(encodeURIComponent(window.btoa(String.fromCharCode.apply(null,new Uint8Array(i)))))}function DecodeUrl(n){var u=window.atob(decodeURIComponent(unescape(n))),t;if(u.length==36){var r=new ArrayBuffer(36),e=new Uint16Array(r,0,7),i=new Uint8Array(r,14,10),f=new Uint32Array(r,24,3),o=new Uint8Array(r);for(t=0;t<u.length;++t)o[t]=u.charCodeAt(t);for(t=0;t<g_SlotCount;++t)g_Quartz[t]=e[t];for(t=0;t<g_SlotCount;t+=2)g_QuartzPlus[t]=i[t>>1]>>4,g_QuartzPlus[t+1]=15&i[t>>1];g_CharId=e[g_SlotCount];g_MQuartz=i[3];g_MQuartzLv=i[4];g_WeaponPlus=i[5]>>4;g_ArmorPlus=15&i[5];g_EnhWeapon=i[6];g_EnhArmor=i[7];g_CharRank=15&i[8];g_CharClo=i[8]>>4;g_CharLv=i[9];g_Weapon=f[0];g_Armor=f[1];g_Acc=f[2];UpdateChara()}else return 0;return 1}function ChangeUrl(){var i=window.location.href,r=i.indexOf("Home/Emu"),n,t;-1!=r&&(n=i.substr(0,r)+"Home/Emu/",t=EncodeUrl(),n+=t,window.history.pushState({cdata:t},0,n))}function UpdateChara(){var r=ch_id2index(g_CharId),e,o,u,i,f,n,t;for(g_Chara=g_ch[r],g_CharaN=g_chn[r],g_CharaD=g_chad[r],e=$("#imgChara"),o=$("#divCharaName"),e.attr("src","/images/ch/"+g_Chara.id+".jpg"),u=g_Chara.namej,g_CharaN.namen.length>0&&(u+="("+g_CharaN.namen+")"),o.html(u),n=0;n<g_SlotCount;++n){for(i=$(g_Slot[n]),f=i.find(".orb-slot-rest"),t=0;t<g_SlotCount;++t)i.removeClass("orb-line-color-"+t);for(t=0;t<7;++t)f.removeClass("etype"+t);i.addClass("orb-line-color-"+g_Chara.slot[n]);7!=g_Chara.slotr[n]&&f.addClass("etype"+g_Chara.slotr[n])}for(n=0;n<=g_Chara.slot[g_SlotCount-1];++n)$(g_Line[n]).removeClass("hidden");for(n=g_Chara.slot[g_SlotCount-1]+1;n<g_LineCount;++n)$(g_Line[n]).addClass("hidden");for(n=0;n<=g_Chara.slot[5];++n)for(t=0;t<7;++t)g_CurLine[n][t]=-1;g_Chara.clo?$(g_EqSlot[5]).removeClass("disabled"):$(g_EqSlot[5]).addClass("disabled");UpdatePanel(-1);UpdateSlot();UpdateQz();UpdateElem()}function UpdateQz(){var l=$("#divQz"),r=$(".qz-type-item"),e=$(".qz-lv-item"),u=$(".qz-plus-item"),s,o,h,c,a,v,n,t,f,i;if(r.removeClass("btn-primary"),e.removeClass("btn-primary"),u.removeClass("btn-primary"),r.addClass("disabled"),e.addClass("disabled"),u.addClass("disabled"),g_SlotCur<0||g_SlotCur>g_SlotCount){l.html("");return}if(e.removeClass("disabled"),s="",g_SlotCur==g_SlotCount){for(r.removeClass("disabled"),$(r[g_QzSelType+1]).addClass("btn-primary"),$("#aMSlot").find(".orb-slot-cursor").removeClass("hidden"),$(e[g_QzSelMLv]).addClass("btn-primary"),n=0;n<g_mq.length;++n)if(-1==g_QzSelType||g_QzSelType==g_mq[n].type){for(t='<a href="javascript:void(0);" class="list-group-item list-group-item-small small text-nowrap orb-qz-item" data-index="'+n+'"><div class="row" style="display: flex;"><div class="col-xs-6"><img src="/images/mq/'+g_mq[n].id+'.png" />',t+='<span class="qrz-rank-'+(1+g_QzSelMLv)+'">',t+=g_mq[n].namej,g_mqn[n].namen.length>0&&(t+="("+g_mqn[n].namen+")"),t+=" LV"+(1+g_QzSelMLv),t+="<\/span>",t+='<\/div><div class="col-xs-6 text-right">',f=g_mq[n].lv[g_QzSelMLv],i=0;i<7;++i)f.elem[i]>0&&(t+='<span class="orb-qz-elem orbixs'+i+'"><\/span><span class="orb'+i+'">'+f.elem[i]+"<\/span>");t+="<\/div><\/div><\/a>";s+=t}}else{for(o=g_Chara.slotr[g_SlotCur],7!=o?($(r[o+1]).removeClass("disabled"),$(r[o+1]).addClass("btn-primary"),h=o):(r.removeClass("disabled"),$(r[g_QzSelType+1]).addClass("btn-primary"),h=g_QzSelType),$(g_Slot[g_SlotCur]).find(".orb-slot-cursor").removeClass("hidden"),$(e[g_QzSelLv]).addClass("btn-primary"),u.removeClass("disabled"),0==g_QzSelPlus?$(u[0]).addClass("btn-primary"):5==g_QzSelPlus?$(u[1]).addClass("btn-primary"):9==g_QzSelPlus&&$(u[2]).addClass("btn-primary"),c={},n=0;n<g_SlotCount;++n)g_SlotCur!=n&&0!=g_Quartz[n]&&(a=qs_id2index(g_Quartz[n]),v=g_qu[a].cate,c[v]=1);for(n=0;n<g_qu.length;++n)if((-1==h||h==g_qu[n].type)&&g_QzSelLv+1==g_qu[n].rank&&!(g_qu[n].cate in c)){for(t='<a href="javascript:void(0);" class="list-group-item list-group-item-small small text-nowrap orb-qz-item" data-index="'+n+'"><div class="row" style="display: flex;"><div class="col-xs-6"><span class="qrzs'+g_qu[n].type+'"><\/span>',t+='<span class="qrz-rank-'+(1+g_QzSelLv)+'">',t+=g_qs[n].namen,g_QzSelPlus>0&&(t+=" +"+g_QzSelPlus),t+="<\/span>",t+='<\/div><div class="col-xs-6 text-right">',f=g_qu[n].lv[g_QzSelPlus],i=0;i<7;++i)f.elem[i]>0&&(t+='<span class="orb-qz-elem orbixs'+i+'"><\/span><span class="orb'+i+'">'+f.elem[i]+"<\/span>");t+="<\/div><\/div><\/a>";s+=t}}l.html(s)}function UpdateLv(){if(99==g_SlotCur){var n=$(".lv-rank-item");$(".lv-slot").find(".orb-slot-cursor").removeClass("hidden");n.removeClass("btn-primary");$(n[g_LvRank-1]).addClass("btn-primary");6==g_LvRank?$("#divLv6").removeClass("hidden"):$("#divLv6").addClass("hidden")}}function UpdateEq(){var u=g_SlotCur-(g_SlotCount+1),t,e,i,n;if(!(u<0)&&!(u>5)){var o=$(".weapon-type-item"),s=$(".armor-type-item"),r=$(".eq-rank-item"),f=$(".eq-plus-item");if(o.removeClass("btn-primary"),s.removeClass("btn-primary"),r.removeClass("btn-primary"),f.removeClass("btn-primary"),o.addClass("disabled"),s.addClass("disabled"),r.addClass("disabled"),f.addClass("disabled"),t="",$(g_EqSlot[u]).find(".orb-slot-cursor").removeClass("hidden"),0==u){for(o.removeClass("disabled"),r.removeClass("disabled"),f.removeClass("disabled"),$(o[g_WeaponType]).addClass("btn-primary"),$(r[g_EqRank-1]).addClass("btn-primary"),$(f[g_EqPlus]).addClass("btn-primary"),e=$("#divEq"),i=0;i<g_eqw.length;++i)(n=g_eqw[i],g_EqRank==n.rank)&&(0==g_WeaponType||g_WeaponType==n.type)&&(n.ch.length>0&&n.ch.indexOf(g_CharId)<0||(t+='<a href="javascript:void(0);" class="list-group-item list-group-item-small small text-nowrap orb-qz-item" data-index="'+i+'"><span class="weapon-icon-'+n.type+'-small"><\/span>',t+='<span class="item-rank-'+n.rank+'">'+n.namej,g_EqPlus>0&&(t+=" +"+g_EqPlus),t+="<\/span>",(g_Chara.tw==n.type||0==n.type)&&(t+='<div class="text-vcenter pull-right text-red"><span class="glyphicon glyphicon-heart"><\/span><\/div>'),n.ch.length>0&&(t+='<div class="text-vcenter pull-right text-red"><span class="glyphicon glyphicon-heart"><\/span><\/div>'),t+="<\/a>"));e.html(t)}else if(1==u){for(s.removeClass("disabled"),r.removeClass("disabled"),f.removeClass("disabled"),$(s[g_ArmorType]).addClass("btn-primary"),$(r[g_EqRank-1]).addClass("btn-primary"),$(f[g_EqPlus]).addClass("btn-primary"),e=$("#divEq"),i=0;i<g_eqa.length;++i)(n=g_eqa[i],g_EqRank==n.rank)&&(0==g_ArmorType||g_ArmorType==n.type)&&(t+='<a href="javascript:void(0);" class="list-group-item list-group-item-small small text-nowrap orb-qz-item" data-index="'+i+'"><span class="armor-icon-0-small"><\/span>',t+='<span class="item-rank-'+n.rank+'">'+n.namej,g_EqPlus>0&&(t+=" +"+g_EqPlus),t+="<\/span>",(g_Chara.ta==n.type||0==n.type)&&(t+='<div class="text-vcenter pull-right text-red"><span class="glyphicon glyphicon-heart"><\/span><\/div>'),t+="<\/a>");e.html(t)}else if(2==u){for(r.removeClass("disabled"),$(r[g_EqRankAcc-1]).addClass("btn-primary"),e=$("#divEq"),i=0;i<g_eqc.length;++i)(n=g_eqc[i],g_EqRankAcc==n.rank)&&(t+='<a href="javascript:void(0);" class="list-group-item list-group-item-small small text-nowrap orb-qz-item" data-index="'+i+'"><span class="acc-icon-0-small"><\/span>',t+='<span class="item-rank-'+n.rank+'">'+n.namej+"<\/span>",t+="<\/a>");e.html(t)}}}function UpdateSlotDisplay(n){var u,t,e,r;if(UpdateElemPreview(-1),n==g_SlotCount){var f=$("#aMSlot"),o=f.find(".orb-slot-name"),s=f.find(".orb-slot-elem"),i=f.find(".orb-slot-btn");if(0!=g_MQuartz){for(u=mq_id2index(g_MQuartz),t='<img src="/images/mq/'+g_mq[u].id+'.png" />',t+='<span class="qrz-rank-'+(1+g_MQuartzLv)+'">',t+=g_mq[u].namej,g_mqn[u].namen.length>0&&(t+="("+g_mqn[u].namen+")"),t+=" LV "+(g_MQuartzLv+1),t+="<\/span>",o.html(t),e=g_mq[u].lv[g_MQuartzLv],t="",r=0;r<7;++r)e.elem[r]>0&&(t+='<span class="art-orb orbis'+r+'"><\/span><span class="orb'+r+'">'+e.elem[r]+"<\/span>");s.html(t);g_MQuartzLv>0?$(i[0]).removeClass("disabled"):$(i[0]).addClass("disabled");g_MQuartzLv<4?$(i[1]).removeClass("disabled"):$(i[1]).addClass("disabled");$(i[2]).removeClass("disabled");$(i[3]).removeClass("disabled")}else o.html(""),s.html(""),i.addClass("disabled")}else{var f=$(g_Slot[n]),o=f.find(".orb-slot-name"),s=f.find(".orb-slot-elem"),i=f.find(".orb-slot-btn");if(0!=g_Quartz[n]){for(u=qs_id2index(g_Quartz[n]),t='<span class="qrzs'+g_qu[u].type+'"><\/span>',t+='<span class="qrz-rank-'+g_qu[u].rank+'">',t+=g_qs[u].namen,g_QuartzPlus[n]>0&&(t+=" +"+g_QuartzPlus[n]),t+="<\/span>",o.html(t),e=g_qu[u].lv[g_QuartzPlus[n]],t="",r=0;r<7;++r)e.elem[r]>0&&(t+='<span class="art-orb orbis'+r+'"><\/span><span class="orb'+r+'">'+e.elem[r]+"<\/span>");s.html(t);g_QuartzPlus[n]>0?$(i[0]).removeClass("disabled"):$(i[0]).addClass("disabled");g_QuartzPlus[n]<9?$(i[1]).removeClass("disabled"):$(i[1]).addClass("disabled");$(i[2]).removeClass("disabled");$(i[3]).removeClass("disabled")}else o.html(""),s.html(""),i.addClass("disabled")}}function UpdateEqw(){var t="",r=eqw_id2index(g_Weapon),n=$(g_EqSlot[0]).find(".eq-slot-btn"),i;r>=0?(i=g_eqw[r],t+='<span class="item-rank-'+i.rank+'">'+i.namej,g_WeaponPlus>0&&(t+=" +"+g_WeaponPlus),t+="<\/span>",i.type!=g_Chara.tw&&(t+='<div class="text-vcenter pull-right text-red"><span class="glyphicon glyphicon-info-sign"><\/span><\/div>'),0==g_WeaponPlus?$(n[0]).addClass("disabled"):$(n[0]).removeClass("disabled"),5==g_WeaponPlus?$(n[1]).addClass("disabled"):$(n[1]).removeClass("disabled"),$(n[2]).removeClass("disabled")):($(n[0]).addClass("disabled"),$(n[1]).addClass("disabled"),$(n[2]).addClass("disabled"));$(g_EqSlot[0]).find(".eq-slot-item").html(t)}function UpdateEqa(){var t="",r=eqa_id2index(g_Armor),n=$(g_EqSlot[1]).find(".eq-slot-btn"),i;r>=0?(i=g_eqa[r],t+='<span class="item-rank-'+i.rank+'">'+i.namej,g_ArmorPlus>0&&(t+=" +"+g_ArmorPlus),t+="<\/span>",i.type!=g_Chara.ta&&(t+='<div class="text-vcenter pull-right text-red"><span class="glyphicon glyphicon-info-sign"><\/span><\/div>'),0==g_ArmorPlus?$(n[0]).addClass("disabled"):$(n[0]).removeClass("disabled"),5==g_ArmorPlus?$(n[1]).addClass("disabled"):$(n[1]).removeClass("disabled"),$(n[2]).removeClass("disabled")):($(n[0]).addClass("disabled"),$(n[1]).addClass("disabled"),$(n[2]).addClass("disabled"));$(g_EqSlot[1]).find(".eq-slot-item").html(t)}function UpdateEqc(){var t="",i=eqc_id2index(g_Acc),r=$(g_EqSlot[2]).find(".eq-slot-btn"),n;i>=0?(n=g_eqc[i],t+='<span class="item-rank-'+n.rank+'">'+n.namej+"<\/span>",$(r[0]).removeClass("disabled")):$(r[0]).addClass("disabled");$(g_EqSlot[2]).find(".eq-slot-item").html(t)}function UpdateEnw(){var t=Math.floor(g_EnhWeapon/10),n='<span class="item-rank-'+((t>>1)+1)+'">'+g_rome[t],i=g_EnhWeapon%10;i>0&&(n+="+"+i);n+="<\/span>";$(g_EqSlot[3]).find(".eq-slot-item").html(n)}function UpdateEna(){var t=Math.floor(g_EnhArmor/10),n='<span class="item-rank-'+((t>>1)+1)+'">'+g_rome[t],i=g_EnhArmor%10;i>0&&(n+="+"+i);n+="<\/span>";$(g_EqSlot[4]).find(".eq-slot-item").html(n)}function UpdateClo(){var n="";n=0==g_CharClo?'<span class="glyphicon glyphicon-ban-circle"><\/span>':"+"+g_CharClo;$(g_EqSlot[5]).find(".eq-slot-item").html(n)}function UpdateEquip(){UpdateEqw();UpdateEqa();UpdateEqc();UpdateEnw();UpdateEna();UpdateClo()}function UpdateLvDisp(){for(var n='<span class="item-rank-'+g_CharRank+'">',t=0;t<g_CharRank;++t)n+='<span class="glyphicon glyphicon-star"><\/span>';n+=" "+g_CharLv+"<span>";$(".lv-slot").find(".eq-slot-item").html(n)}function CalcEq(n,t,i,r){for(var f=0==r||r==t.type?0:.3,u=0;u<t.k.length;++u)switch(t.k[u]){case 2:n.hp+=Math.floor(t.v[u]+t.g[u]*i)-parseInt(f*(t.v[u]+t.g[u]*i));break;case 4:n.ep+=Math.floor(t.v[u]+t.g[u]*i)-parseInt(f*(t.v[u]+t.g[u]*i));break;case 6:n.str+=Math.floor(t.v[u]+t.g[u]*i)-parseInt(f*(t.v[u]+t.g[u]*i));break;case 7:n.def+=Math.floor(t.v[u]+t.g[u]*i)-parseInt(f*(t.v[u]+t.g[u]*i));break;case 8:n.ats+=Math.floor(t.v[u]+t.g[u]*i)-parseInt(f*(t.v[u]+t.g[u]*i));break;case 9:n.adf+=Math.floor(t.v[u]+t.g[u]*i)-parseInt(f*(t.v[u]+t.g[u]*i));break;case 10:n.spd+=Math.floor(t.v[u]+t.g[u]*i)-parseInt(f*(t.v[u]+t.g[u]*i));break;case 11:n.mov+=Math.floor(t.v[u]+t.g[u]*i)-parseInt(f*(t.v[u]+t.g[u]*i));break;case 12:n.dex+=Math.floor(t.v[u]+t.g[u]*i)-parseInt(f*(t.v[u]+t.g[u]*i));break;case 13:n.agl+=Math.floor(t.v[u]+t.g[u]*i)-parseInt(f*(t.v[u]+t.g[u]*i));break;case 14:n.rng+=Math.floor(t.v[u]+t.g[u]*i)-parseInt(f*(t.v[u]+t.g[u]*i))}}function CalcQz(n,t,i){for(var r=0;r<t.k.length;++r)switch(t.k[r]){case 2:n.hp+=t.v[r];break;case 4:n.ep+=t.v[r];break;case 6:n.str+=t.v[r];break;case 7:n.def+=t.v[r];break;case 8:n.ats+=t.v[r];break;case 9:n.adf+=t.v[r];break;case 10:n.spd+=Math.ceil(i*t.v[r]/100);break;case 11:n.mov+=t.v[r];break;case 12:n.dex+=t.v[r];break;case 13:n.agl+=t.v[r];break;case 14:n.rng+=t.v[r]}}function CalcBasic(n){var t={hp:0,ep:0,str:0,def:0,ats:0,adf:0,dex:0,agl:0,spd:0,mov:0,rng:0,cp:0},u,c,d,l,g,a,v,y,p,nt,w,tt,e,ft,o,i,k,r,rt,ut,f;n?(g_PrevCharLv<=30?(r=g_CharaD.lv[g_PrevCharRank-1],u=g_PrevCharLv-1):(r=g_CharaD.lv[6+(g_PrevCharLv-31>>1)],u=(g_PrevCharLv-31&1)+1),c=g_PrevWeapon,d=g_PrevWeaponPlus,l=g_PrevArmor,g=g_PrevArmorPlus,a=g_PrevAcc,v=g_PrevEnhWeapon,y=g_PrevEnhArmor,p=g_PrevMQuartz,nt=g_PrevMQuartzLv,w=g_PrevQuartz,tt=g_PrevQuartzPlus,e=g_PrevCharClo):(g_CharLv<=30?(r=g_CharaD.lv[g_CharRank-1],u=g_CharLv-1):(r=g_CharaD.lv[6+(g_CharLv-31>>1)],u=(g_CharLv-31&1)+1),c=g_Weapon,d=g_WeaponPlus,l=g_Armor,g=g_ArmorPlus,a=g_Acc,v=g_EnhWeapon,y=g_EnhArmor,p=g_MQuartz,nt=g_MQuartzLv,w=g_Quartz,tt=g_QuartzPlus,e=g_CharClo);var s=Math.floor(v/10),b=v%10,h=Math.floor(y/10),it=y%10;for(t.hp=Math.floor(r.hp+r.hpr*u*24.999984401809389),t.ep=g_Chara.ep,t.str=Math.floor(r.str+r.strr*u),t.def=Math.floor(r.def+r.defr*u),t.ats=Math.floor(r.ats+r.atsr*u),t.adf=Math.floor(r.adf+r.adfr*u),t.dex=Math.floor(r.dex+r.dexr*u),t.agl=Math.floor(r.agl+r.aglr*u),t.spd=Math.floor(r.spd+r.spdr*u),t.mov=g_Chara.mov,t.rng=g_Chara.rng,1==g_Chara.clo&&e>0&&(t.hp+=Math.ceil(t.hp*.02*e),t.ep+=Math.ceil(t.ep*.02*e),t.str+=Math.ceil(t.str*.02*e),t.def+=Math.ceil(t.def*.02*e),t.ats+=Math.ceil(t.ats*.02*e),t.adf+=Math.ceil(t.adf*.02*e)),ft=t.spd,c>0&&(o=eqw_id2index(c),o>=0&&CalcEq(t,g_eqw[o],d,g_Chara.tw)),l>0&&(o=eqa_id2index(l),o>=0&&CalcEq(t,g_eqa[o],g,g_Chara.ta)),a>0&&(o=eqc_id2index(a),o>=0&&CalcEq(t,g_eqc[o],0,0)),i=0;i<g_CharaD.stre.length;++i)t.str+=Math.floor(g_CharaD.stre[i].i[s]+b*g_CharaD.stre[i].g[s]);for(i=0;i<g_CharaD.atse.length;++i)t.ats+=Math.floor(g_CharaD.atse[i].i[s]+b*g_CharaD.atse[i].g[s]);for(i=0;i<g_CharaD.spde.length;++i)t.spd+=Math.floor(g_CharaD.spde[i].i[s]+b*g_CharaD.spde[i].g[s]);for(i=0;i<g_CharaD.defw.length;++i)t.def+=Math.floor(g_CharaD.defw[i].i[s]+b*g_CharaD.defw[i].g[s]);for(i=0;i<g_CharaD.hpe.length;++i)t.hp+=Math.floor(g_CharaD.hpe[i].i[h]+it*g_CharaD.hpe[i].g[h]);for(i=0;i<g_CharaD.defe.length;++i)t.def+=Math.floor(g_CharaD.defe[i].i[h]+it*g_CharaD.defe[i].g[h]);for(i=0;i<g_CharaD.adfe.length;++i)t.adf+=Math.floor(g_CharaD.adfe[i].i[h]+it*g_CharaD.adfe[i].g[h]);for(0!=p&&(k=mq_id2index(p),r=g_mq[k].lv[nt],t.hp+=r.hp,t.ep+=r.ep,t.str+=r.str,t.def+=r.def,t.ats+=r.ats,t.adf+=r.adf,t.spd+=r.spd),f=0;f<g_SlotCount;++f)0!=w[f]&&(k=qs_id2index(w[f]),r=g_qu[k].lv[tt[f]],CalcQz(t,r,ft));for(t.cp=Math.floor((t.hp*4+t.str*10+t.ats*10+t.def*5+t.adf*5)*t.spd/200),rt=-1,ut=0,f=0;f<6;++f)rt!=g_Chara.slot[f]&&(rt=g_Chara.slot[f],ut=-1),t.ep+=g_slotep[++ut];return t}function UpdateBasic(){var n=CalcBasic(!1);$("#divcpower").html(n.cp);$("#divhp").html(n.hp);$("#divep").html(n.ep);$("#divstr").html(n.str);$("#divdef").html(n.def);$("#divats").html(n.ats);$("#divadf").html(n.adf);$("#divdex").html(n.dex);$("#divagl").html(n.agl);$("#divspd").html(n.spd);$("#divmov").html(n.mov);$("#divrng").html(n.rng)}function gpv(n,t){var i=n;return n<t?i+='<span class="text-green">(+'+(t-n)+")<\/span>":n>t&&(i+='<span class="text-red">(-'+(n-t)+")<\/span>"),i}function UpdatePrevBasic(){var n=CalcBasic(!1),t=CalcBasic(!0);$("#divcpower").html(gpv(n.cp,t.cp));$("#divhp").html(gpv(n.hp,t.hp));$("#divep").html(gpv(n.ep,t.ep));$("#divstr").html(gpv(n.str,t.str));$("#divdef").html(gpv(n.def,t.def));$("#divats").html(gpv(n.ats,t.ats));$("#divadf").html(gpv(n.adf,t.adf));$("#divdex").html(gpv(n.dex,t.dex));$("#divagl").html(gpv(n.agl,t.agl));$("#divspd").html(gpv(n.spd,t.spd));$("#divmov").html(gpv(n.mov,t.mov));$("#divrng").html(gpv(n.rng,t.rng))}function UpdateSlot(){UpdateSlotDisplay(g_SlotCount);for(var n=0;n<g_SlotCount;++n)UpdateSlotDisplay(n);UpdateLvDisp();UpdateEquip();UpdateBasic()}function CalcElem(){for(var r,u,t,i=[],n=0;n<=g_Chara.slot[5];++n)i.push([0,0,0,0,0,0,0]);if(0!=g_MQuartz)for(r=mq_id2index(g_MQuartz),u=g_mq[r].lv[g_MQuartzLv],n=0;n<=g_Chara.slot[5];++n)for(t=0;t<7;++t)i[n][t]+=u.elem[t];for(n=0;n<g_SlotCount;++n)if(0!=g_Quartz[n]){var r=qs_id2index(g_Quartz[n]),f=g_Chara.slot[n],u=g_qu[r].lv[g_QuartzPlus[n]];for(t=0;t<7;++t)i[f][t]+=u.elem[t]}return i}function CalcElemPrev(){for(var r,u,t,i=[],n=0;n<=g_Chara.slot[5];++n)i.push([0,0,0,0,0,0,0]);if(0!=g_PrevMQuartz)for(r=mq_id2index(g_PrevMQuartz),u=g_mq[r].lv[g_PrevMQuartzLv],n=0;n<=g_Chara.slot[5];++n)for(t=0;t<7;++t)i[n][t]+=u.elem[t];for(n=0;n<g_SlotCount;++n)if(0!=g_PrevQuartz[n]){var r=qs_id2index(g_PrevQuartz[n]),f=g_Chara.slot[n],u=g_qu[r].lv[g_PrevQuartzPlus[n]];for(t=0;t<7;++t)i[f][t]+=u.elem[t]}return i}function UpdateElem(){for(var r,t,i=CalcElem(),n=0;n<=g_Chara.slot[5];++n)for(t=0;t<7;++t)g_CurLine[n][t]=i[n][t],r=$(g_Line[n]).find(".orb"+t),r.html(i[n][t]);for(n=0;n<g_art.length;++n)for(g_CurArt[n]=0,t=0;t<=g_Chara.slot[5];++t)if(i[t][0]>=g_art[n].elem[0]&&i[t][1]>=g_art[n].elem[1]&&i[t][2]>=g_art[n].elem[2]&&i[t][3]>=g_art[n].elem[3]&&i[t][4]>=g_art[n].elem[4]&&i[t][5]>=g_art[n].elem[5]&&i[t][6]>=g_art[n].elem[6]){g_CurArt[n]=1;break}UpdateArt()}function UpdateElemPreview(n){var u,f,o,s,h,r,t,i,e;if(g_PrevRegion!=n){if(g_PrevRegion=n,-1!=g_PrevRegion){for(u=CalcElem(),r=CalcElemPrev(),t=0;t<=g_Chara.slot[5];++t)for(i=0;i<7;++i)(r[t][i]!=u[t][i]||r[t][i]!=g_CurLine[t][i])&&(g_CurLine[t][i]=r[t][i],e=$(g_Line[t]).find(".orb"+i),f="",f+=u[t][i],r[t][i]>u[t][i]?f+='<span class="text-green">('+r[t][i]+")<\/span>":r[t][i]<u[t][i]&&(f+='<span class="text-red">('+r[t][i]+")<\/span>"),e.html(f));for(o={},t=0;t<g_art.length;++t)for(i=0;i<=g_Chara.slot[5];++i)if(r[i][0]>=g_art[t].elem[0]&&r[i][1]>=g_art[t].elem[1]&&r[i][2]>=g_art[t].elem[2]&&r[i][3]>=g_art[t].elem[3]&&r[i][4]>=g_art[t].elem[4]&&r[i][5]>=g_art[t].elem[5]&&r[i][6]>=g_art[t].elem[6]){o[g_art[t].id]=1;break}for(t=0;t<g_art.length;++t)1==g_CurArt[t]?(g_art[t].id in o?(g_PrevCurArt[t]=1,g_PrevCurArtRemove[t]=0):(g_PrevCurArt[t]=0,g_PrevCurArtRemove[t]=1),g_PrevCurArtAdd[t]=0):(g_PrevCurArtAdd[t]=g_art[t].id in o?1:0,g_PrevCurArt[t]=0,g_PrevCurArtRemove[t]=0);UpdatePrevBasic()}else{for(s=$("#divArt"),h=s.children(),t=0;t<g_art.length*2;++t)1==g_CurAV[t]&&(g_CurAV[t]=0,$(h[t]).addClass("hidden"));for(r=CalcElem(),t=0;t<=g_Chara.slot[5];++t)for(i=0;i<7;++i)r[t][i]!=g_CurLine[t][i]&&(g_CurLine[t][i]=r[t][i],e=$(g_Line[t]).find(".orb"+i),e.html(r[t][i]));UpdateBasic()}UpdateArt()}}function UpdateArt(){var f=$("#divArt"),t=f.children(),i,r,u,n;if(-1==g_PrevRegion)for(i=g_art.length*2,n=0;n<g_CurArt.length;++n)1==g_CurArt[n]?0==g_CurAV[i+n]&&(g_CurAV[i+n]=1,$(t[i+n]).removeClass("hidden")):1==g_CurAV[i+n]&&(g_CurAV[i+n]=0,$(t[i+n]).addClass("hidden"));else{for(r=g_art.length,u=g_art.length+g_art.length,n=0;n<g_art.length;++n)1==g_PrevCurArtAdd[n]?0==g_CurAV[n]&&(g_CurAV[n]=1,$(t[n]).removeClass("hidden")):1==g_CurAV[n]&&(g_CurAV[n]=0,$(t[n]).addClass("hidden")),1==g_PrevCurArtRemove[n]?0==g_CurAV[r+n]&&(g_CurAV[r+n]=1,$(t[r+n]).removeClass("hidden")):1==g_CurAV[r+n]&&(g_CurAV[r+n]=0,$(t[r+n]).addClass("hidden")),1==g_PrevCurArt[n]?0==g_CurAV[u+n]&&(g_CurAV[u+n]=1,$(t[u+n]).removeClass("hidden")):1==g_CurAV[u+n]&&(g_CurAV[u+n]=0,$(t[u+n]).addClass("hidden"));f.prepend("")}}function UpdateCharaSel(){var e=$("#divCharaSel"),f=$(".chara-type"),i,r,u,t,n;for(f.removeClass("btn-primary"),$(f[g_CharaSelType+1]).addClass("btn-primary"),i=$(".chara-genre"),i.removeClass("btn-primary"),$(i[g_CharaSelGenre+1]).addClass("btn-primary"),r=$(".chara-at"),r.removeClass("btn-primary"),$(r[g_CharaSelAT+1]).addClass("btn-primary"),u=$(".chara-gender"),u.removeClass("btn-primary"),$(u[g_CharaSelGender+1]).addClass("btn-primary"),t="",n=0;n<g_ch.length;++n)(-1==g_CharaSelType||g_CharaSelType==g_ch[n].type)&&(-1==g_CharaSelGenre||g_CharaSelGenre==g_ch[n].genr)&&(-1==g_CharaSelAT||g_CharaSelAT==(g_chad[n].stre.length>0?0:1))&&(-1==g_CharaSelGender||g_CharaSelGender==g_ch[n].gend)&&(t+='<div class="col-lg-1 col-md-2 col-sm-2 col-xs-4">',t+='<a href="javascript:void(0);" class="thumbnail chara-head-container chara-sel-item" data-toggle="tooltip" title="'+g_ch[n].namej,g_chn[n].namen.length>0&&(t+="("+g_chn[n].namen+")"),t+='" data-index="'+n+'">',t+='<div class="img-rounded"><img src="/images/ch/'+g_ch[n].id+'.jpg" /><\/div>',t+='<div class="img-circle image-tag no-padding" style="position:relative; width: 21px; height: 21px; right: 1px; bottom: 71px;"><span class="etype'+g_ch[n].type+'"><\/span><\/div>',t+="<\/a><\/div>");e.html(t);$("body").tooltip({selector:'[data-toggle="tooltip"]',html:!0})}function UpdatePanel(n){$(".slot").find(".orb-slot-cursor").addClass("hidden");$("#divSelQz").addClass("hidden");$("#divSelEq").addClass("hidden");$("#divSelEnh").addClass("hidden");$("#divSelLv").addClass("hidden");$("#divSelClo").addClass("hidden");0==n?$("#divSelQz").removeClass("hidden"):1==n?$("#divSelEq").removeClass("hidden"):2==n?$("#divSelEnh").removeClass("hidden"):3==n?$("#divSelLv").removeClass("hidden"):4==n&&$("#divSelClo").removeClass("hidden")}function PreparePreview(){g_PrevMQuartz=g_MQuartz;g_PrevMQuartzLv=g_MQuartzLv;for(var n=0;n<g_SlotCount;++n)g_PrevQuartz[n]=g_Quartz[n],g_PrevQuartzPlus[n]=g_QuartzPlus[n];g_PrevWeapon=g_Weapon;g_PrevWeaponPlus=g_WeaponPlus;g_PrevArmor=g_Armor;g_PrevArmorPlus=g_ArmorPlus;g_PrevAcc=g_Acc;g_PrevEnhWeapon=g_EnhWeapon;g_PrevEnhArmor=g_EnhArmor;g_PrevCharRank=g_CharRank;g_PrevCharLv=g_CharLv;g_PrevCharClo=g_CharClo}function GenEqStr(n,t,i){var u,r,f;for(i==null&&(i=g_kstr.length),u="",r=0;r<n.k.length;++r)n.k[r]>=i||(f=Math.floor(n.v[r]+n.g[r]*t),0!=f)&&(u.length>0&&(u+=", "),u+=g_kstr[n.k[r]],u+=f>0?"+"+f:"-"+-f,(16==n.k[r]||18==n.k[r])&&(u+="%"));return u}function GenAccStr(n){return GenEqStr(n,0,15)}function GenEqwDesc(n,t){var i=g_eqw[n],r=GenEqStr(i,t);return r+="<br/>",r+i.desc}function GenEqaDesc(n,t){var r=g_eqa[n],i=GenEqStr(r,t);return i+="<br/>",r.desc.length>0?(i+=r.desc,i+="<br/>"):i.length>0&&(i+="<br/>"),i}function GenEqcDesc(n){var i=g_eqc[n],t=GenAccStr(i);return i.desc0.length>0?(t+=i.desc0,t+="<br/>"):t.length>0&&(t+="<br/>"),t+i.desc1}function GenEnwDesc(n){for(var r=Math.floor(n/10),l=n%10,i="",u=0,f=0,e=0,o=0,s=0,h=0,c=0,t=0;t<g_CharaD.stre.length;++t)u+=Math.floor(g_CharaD.stre[t].i[r]+l*g_CharaD.stre[t].g[r]);for(t=0;t<g_CharaD.atse.length;++t)e+=Math.floor(g_CharaD.atse[t].i[r]+l*g_CharaD.atse[t].g[r]);for(t=0;t<g_CharaD.spde.length;++t)o+=Math.floor(g_CharaD.spde[t].i[r]+l*g_CharaD.spde[t].g[r]);for(t=0;t<g_CharaD.defw.length;++t)f+=Math.floor(g_CharaD.defw[t].i[r]+l*g_CharaD.defw[t].g[r]);for(t=0;t<g_CharaD.crw.length;++t)s+=g_CharaD.crw[t].i[r];for(t=0;t<g_CharaD.dew.length;++t)h+=g_CharaD.dew[t].i[r];for(t=0;t<g_CharaD.agw.length;++t)c+=g_CharaD.agw[t].i[r];return u>0?i+="STR+"+u+", ":u<0&&(i+="STR-"+-u+", "),f>0?i+="DEF+"+f+", ":f<0&&(i+="DEF-"+-f+", "),e>0?i+="ATS+"+e+", ":e<0&&(i+="ATS-"+-e+", "),o>0?i+="SPD+"+o+", ":o<0&&(i+="SPD-"+-o+", "),s>0?i+=g_kstr[21]+"+"+s+"%, ":s<0&&(i+=g_kstr[21]+"-"+-s+"%, "),h>0?i+=g_kstr[16]+"+"+h+"%, ":h<0&&(i+=g_kstr[16]+"-"+-h+"%, "),c>0?i+=g_kstr[18]+"+"+c+"%, ":c<0&&(i+=g_kstr[18]+"-"+-c+"%, "),i.length>0&&(i=i.substr(0,i.length-2)),i}function GenEnaDesc(n){for(var r=Math.floor(n/10),c=n%10,i="",u=0,f=0,e=0,o=0,s=0,h=0,t=0;t<g_CharaD.hpe.length;++t)u+=Math.floor(g_CharaD.hpe[t].i[r]+c*g_CharaD.hpe[t].g[r]);for(t=0;t<g_CharaD.defe.length;++t)f+=Math.floor(g_CharaD.defe[t].i[r]+c*g_CharaD.defe[t].g[r]);for(t=0;t<g_CharaD.adfe.length;++t)e+=Math.floor(g_CharaD.adfe[t].i[r]+c*g_CharaD.adfe[t].g[r]);for(t=0;t<g_CharaD.cra.length;++t)o+=g_CharaD.cra[t].i[r];for(t=0;t<g_CharaD.dea.length;++t)s+=g_CharaD.dea[t].i[r];for(t=0;t<g_CharaD.aga.length;++t)h+=g_CharaD.aga[t].i[r];return u>0?i+="MAX HP+"+u+", ":u<0&&(i+="MAX HP-"+-u+", "),f>0?i+="DEF+"+f+", ":f<0&&(i+="DEF-"+-f+", "),e>0?i+="ADF+"+e+", ":e<0&&(i+="ADF-"+-e+", "),o>0?i+=g_kstr[21]+"+"+o+"%, ":o<0&&(i+=g_kstr[21]+"-"+-o+"%, "),s>0?i+=g_kstr[16]+"+"+s+"%, ":s<0&&(i+=g_kstr[16]+"-"+-s+"%, "),h>0?i+=g_kstr[18]+"+"+h+"%, ":h<0&&(i+=g_kstr[18]+"-"+-h+"%, "),i.length>0&&(i=i.substr(0,i.length-2)),i}function GenMqDesc(n,t){var i=g_mq[n].lv[t],r="MAX HP+"+i.hp+", MAX EP+"+i.ep+", STR+"+i.str+", DEF+"+i.def+", ATS+"+i.ats+", ADF+"+i.adf;return i.spd>0&&(r+=", SPD+"+i.spd),r+="<br/>",r+(g_mqn[n].lv[t].abi0+"<br/>"+g_mqn[n].lv[t].abi1)}var g_slotep=[37,57,85,115,170,225],g_SlotCount=6,g_LineCount=6,g_Slot=$(".orb-slot-item"),g_Line=$(".orb-line-item"),g_EqSlot=$(".eq-slot"),g_CharId=9,g_MQuartz,g_MQuartzLv,g_Quartz,g_QuartzPlus,g_Weapon,g_WeaponPlus,g_Armor,g_ArmorPlus,g_Acc,g_EnhWeapon,g_EnhArmor,g_CharRank,g_CharLv,g_CharClo,g_CurArt,g_CurLine,g_CurAV,g_PrevRegion=-1,g_PrevMQuartz,g_PrevMQuartzLv,g_PrevQuartz,g_PrevQuartzPlus,g_PrevCurArt,g_PrevCurArtAdd,g_PrevCurArtRemove,g_PrevWeapon,g_PrevWeaponPlus,g_PrevArmor,g_PrevArmorPlus,g_PrevAcc,g_PrevEnhWeapon,g_PrevEnhArmor,g_PrevCharRank,g_PrevCharLv,g_PrevCharClo,g_Chara,g_CharaN,g_CharaD,g_SlotCur=-1,g_QzSelType=-1,g_QzSelMLv=4,g_QzSelLv=2,g_QzSelPlus=0,g_CharaSelType=-1,g_CharaSelGenre=-1,g_CharaSelAT=-1,g_CharaSelGender=-1,g_WeaponType=0,g_ArmorType=0,g_EqRank=4,g_EqRankAcc=3,g_EqPlus=0,g_LvRank=6;$(".chara-type").click(function(){g_CharaSelType=parseInt($(this).attr("data-index"));UpdateCharaSel()});$(".chara-genre").click(function(){g_CharaSelGenre=parseInt($(this).attr("data-index"));UpdateCharaSel()});$(".chara-at").click(function(){g_CharaSelAT=parseInt($(this).attr("data-index"));UpdateCharaSel()});$(".chara-gender").click(function(){g_CharaSelGender=parseInt($(this).attr("data-index"));UpdateCharaSel()});$("#divArt").on("mouseover","a",function(){var r=parseInt($(this).attr("data-index")),t=g_art[r],i=g_artn[r],n="";n+=1==t.att?g_str_att:g_str_aux;n+=": "+i.range;i.eff.length>0&&(n+="・"+i.eff);n+="<br/>"+i.desc+"<br/>";t.pwr>0&&(n+=g_str_pwr+": "+t.pwr+", ");n+=g_str_drv+": "+t.drv+", "+g_str_dly+": "+t.dly;$("#divDesc").html(n)});$("#divArt").on("mouseleave","a",function(){$("#divDesc").html("")});$(".lv-slot").click(function(){g_SlotCur=g_SlotCur==99?-1:99;UpdatePanel(-1==g_SlotCur?-1:3);UpdateLv()});$(".eq-slot").mouseover(function(){var n=parseInt($(this).attr("data-index"));0==n&&0!=g_Weapon?$("#divDesc").html(GenEqwDesc(eqw_id2index(g_Weapon),g_WeaponPlus)):1==n&&0!=g_Armor?$("#divDesc").html(GenEqaDesc(eqa_id2index(g_Armor),g_ArmorPlus)):2==n&&0!=g_Acc?$("#divDesc").html(GenEqcDesc(eqc_id2index(g_Acc))):3==n?$("#divDesc").html(GenEnwDesc(g_EnhWeapon)):4==n&&$("#divDesc").html(GenEnaDesc(g_EnhWeapon))});$(".eq-slot").mouseleave(function(){$("#divDesc").html("")});$(".eq-slot").click(function(){var n=parseInt($(this).attr("data-index"));if(g_SlotCur=g_SlotCur==g_SlotCount+n+1?-1:g_SlotCount+n+1,-1==g_SlotCur)UpdatePanel(-1);else if(n<3)UpdatePanel(1);else if(n<5)UpdatePanel(2);else if(5==n){if(0==g_Chara.clo)return;UpdatePanel(4)}UpdateEq()});$(".orb-slot-master").mouseover(function(){if(0!=g_MQuartz){var n=mq_id2index(g_MQuartz);$("#divDesc").html(GenMqDesc(n,g_MQuartzLv))}});$(".orb-slot-master").mouseleave(function(){$("#divDesc").html("")});$(".orb-slot-master").click(function(){g_SlotCur=g_SlotCur==g_SlotCount?-1:g_SlotCount;UpdatePanel(-1==g_SlotCur?-1:0);UpdateQz()});$(".orb-slot-item").mouseover(function(){var n=parseInt($(this).attr("data-index"));0!=g_Quartz[n]&&$("#divDesc").html(g_qs[qs_id2index(g_Quartz[n])].lv[g_QuartzPlus[n]].desc)});$(".orb-slot-item").mouseleave(function(){$("#divDesc").html("")});$(".orb-slot-item").click(function(){var n=parseInt($(this).attr("data-index"));g_SlotCur=g_SlotCur==n?-1:n;UpdatePanel(-1==g_SlotCur?-1:0);UpdateQz()});$(".orb-slot-btn").mouseover(function(){var r=this.parentElement.parentElement.parentElement.parentElement.parentElement,i,t,n;if(r)if(PreparePreview(),i=$(r),t=$(this).attr("data-op"),i.hasClass("orb-slot-master")){if(0==g_PrevMQuartz)return;"min"==t&&g_PrevMQuartzLv>0?(--g_PrevMQuartzLv,UpdateElemPreview(-1e3)):"add"==t&&g_PrevMQuartzLv<4?(++g_PrevMQuartzLv,UpdateElemPreview(-1001)):"remove"==t&&(g_PrevMQuartz=0,g_PrevMQuartzLv=0,UpdateElemPreview(-1002))}else{if(n=parseInt(i.attr("data-index")),0==g_PrevQuartz[n])return;"min"==t&&g_PrevQuartzPlus[n]>0?(g_PrevQuartzPlus[n]=9==g_PrevQuartzPlus[n]?5:0,UpdateElemPreview(-1003)):"add"==t&&g_PrevQuartzPlus[n]<9?(g_PrevQuartzPlus[n]=0==g_PrevQuartzPlus[n]?5:9,UpdateElemPreview(-1004)):"remove"==t&&(g_PrevQuartz[n]=0,g_PrevQuartzPlus[n]=0,UpdateElemPreview(-1006))}});$(".orb-slot-btn").mouseleave(function(){UpdateElemPreview(-1)});$(".orb-slot-btn").click(function(n){var l,a,e,f,h,p,r,u,i,c;if(n||(n=window.event),n.cancelBubble=!0,n.stopPropagation&&n.stopPropagation(),l=this.parentElement.parentElement.parentElement.parentElement.parentElement,l)if(a=$(l),e=$(this).attr("data-op"),a.hasClass("orb-slot-master")){if(0==g_MQuartz)return;if("min"==e&&g_MQuartzLv>0)--g_MQuartzLv,UpdateSlotDisplay(g_SlotCount),UpdateElem(),ChangeUrl();else if("add"==e&&g_MQuartzLv<4)++g_MQuartzLv,UpdateSlotDisplay(g_SlotCount),UpdateElem(),ChangeUrl();else if("where"==e){var s=g_mq[mq_id2index(g_MQuartz)],v=g_mqn[mq_id2index(g_MQuartz)],w=$("#divWhere"),t='<div class="modal-header"><h4 class="modal-title"><img src="/images/mq/'+s.id+'.png" />'+s.namej;for(v.namen.length>0&&(t+="("+v.namen+")"),t+='<\/h4><\/div><div class="modal-body">',t+='<div class="row">',t+='<div class="col-xs-7"><table class="table"><thead><tr>',t+="<td>LV<\/td>",t+='<td><span class="orbi0"><\/span><\/td>',t+='<td><span class="orbi1"><\/span><\/td>',t+='<td><span class="orbi2"><\/span><\/td>',t+='<td><span class="orbi3"><\/span><\/td>',t+='<td><span class="orbi4"><\/span><\/td>',t+='<td><span class="orbi5"><\/span><\/td>',t+='<td><span class="orbi6"><\/span><\/td>',t+="<td>HP<\/td><td>EP<\/td><td>STR<\/td><td>DEF<\/td><td>ATS<\/td><td>ADF<\/td><td>SPD<\/td>",t+="<\/tr><\/thead><tbody>",i=0;i<s.lv.length;++i){for(t+="<tr",i==g_MQuartzLv&&(t+=' class="orb-qz-info-active"'),t+=">",u=s.lv[i],t+='<td class="qrz-rank-'+(1+i)+'">',t+="LV"+(i+1),t+="<\/td>",r=0;r<7;++r)t+="<td>",u.elem[r]>0&&(t+='<span class="orb'+r+'">'+u.elem[r]+"<\/span>"),t+="<\/td>";t+="<td>"+u.hp+"<\/td>";t+="<td>"+u.ep+"<\/td>";t+="<td>"+u.str+"<\/td>";t+="<td>"+u.def+"<\/td>";t+="<td>"+u.ats+"<\/td>";t+="<td>"+u.adf+"<\/td>";t+="<td>"+u.spd+"<\/td>";t+="<\/tr>"}t+="<\/tbody><\/table><\/div>";t+='<div class="col-xs-5"><h3>'+g_str_drop+"<\/h3>";t+=v.howg;t+="<\/div>";t+="<\/div><\/div>";w.html(t);$("#dlgWhere").modal("show")}else"remove"==e&&(g_MQuartz=0,g_MQuartzLv=0,UpdateSlotDisplay(g_SlotCount),UpdateElem(),ChangeUrl())}else{if(f=parseInt(a.attr("data-index")),0==g_Quartz[f])return;if("min"==e&&g_QuartzPlus[f]>0)g_QuartzPlus[f]=9==g_QuartzPlus[f]?5:0,UpdateSlotDisplay(f),UpdateElem(),ChangeUrl();else if("add"==e&&g_QuartzPlus[f]<9)g_QuartzPlus[f]=0==g_QuartzPlus[f]?5:9,UpdateSlotDisplay(f),UpdateElem(),ChangeUrl();else if("where"==e){var o=g_qu[qs_id2index(g_Quartz[f])],y=g_qs[qs_id2index(g_Quartz[f])],w=$("#divWhere"),t='<div class="modal-header"><h4 class="modal-title"><span class="qrzs'+o.type+'"><\/span>';for(t+='<span class="qrz-rank-'+o.rank+'">',t+=y.namen+'<\/span><\/h4><\/div><div class="modal-body">',t+='<div class="row">',t+='<div class="col-xs-7"><table class="table"><thead><tr>',t+="<td>"+g_str_qzcol[0]+"<\/td>",t+="<td>"+g_str_qzcol[1]+"<\/td>",t+="<td>"+g_str_qzcol[2]+"<\/td>",t+="<\/tr><\/thead><tbody>",i=0;i<o.lv.length;++i){for(t+="<tr",i==g_QuartzPlus[f]&&(t+=' class="orb-qz-info-active"'),t+=">",u=o.lv[i],t+="<td>",i>0&&(t+="+"+i),t+="<\/td>",t+="<td>",r=0;r<7;++r)u.elem[r]>0&&(t+='<span class="art-orb orbis'+r+'"><\/span><span class="orb'+r+'">'+u.elem[r]+"<\/span>");t+="<\/td>";t+="<td>"+y.lv[i].desc+"<\/td>";t+="<\/tr>"}for(t+="<\/tbody><\/table><\/div>",t+='<div class="col-xs-5"><h3>'+g_str_drop+"<\/h3>",t+='<table class="table"><tbody>',h=0;h<g_dun.length;++h)for(p=g_dun[h],r=0;r<3;++r)for(u=p.lv[r],i=0;i<u.qz.length;++i)c=u.qz[i],c.id==o.id&&(t+="<tr><td>",t+=p.namej+" "+g_str_lv[r]+" "+(i+1),t+='<\/td><td class="qrz-rank-'+o.rank+'">',t+='<span class="qrzs'+o.type+'"><\/span>'+y.namen,c.pls>0&&(t+=" +"+c.pls),t+="<\/td><\/tr>");t+="<\/tbody><\/table>";t+="<\/div>";t+="<\/div><\/div>";w.html(t);$("#dlgWhere").modal("show")}else"remove"==e&&(g_Quartz[f]=0,g_QuartzPlus[f]=0,UpdateSlotDisplay(f),UpdateElem(),UpdateQz(),ChangeUrl())}});$(".eq-slot-btn").mouseover(function(){var i,t,n;PreparePreview();i=$(this).attr("data-eq");t=$(this).attr("data-op");"weapon"==i?(n=!1,"min"==t&&g_PrevWeapon>0&&g_PrevWeaponPlus>0?(--g_PrevWeaponPlus,n=!0):"add"==t&&g_PrevWeapon>0&&g_PrevWeaponPlus<5?(++g_PrevWeaponPlus,n=!0):"remove"==t&&g_PrevWeapon>0&&(g_PrevWeapon=0,g_PrevWeaponPlus=0,n=!0),n&&UpdatePrevBasic()):"armor"==i?(n=!1,"min"==t&&g_PrevArmor>0&&g_PrevArmorPlus>0?(--g_PrevArmorPlus,n=!0):"add"==t&&g_PrevArmor>0&&g_PrevArmorPlus<5?(++g_PrevArmorPlus,n=!0):"remove"==t&&g_PrevArmor>0&&(g_PrevArmor=0,g_PrevArmorPlus=0,n=!0),n&&UpdatePrevBasic()):"acc"==i&&"remove"==t&&g_PrevAcc>0&&(g_PrevAcc=0,UpdatePrevBasic())});$(".eq-slot-btn").mouseleave(function(){UpdateBasic()});$(".eq-slot-btn").click(function(n){var r,i,t;n||(n=window.event);n.cancelBubble=!0;n.stopPropagation&&n.stopPropagation();r=$(this).attr("data-eq");i=$(this).attr("data-op");"weapon"==r?(t=!1,"min"==i&&g_Weapon>0&&g_WeaponPlus>0?(--g_WeaponPlus,t=!0):"add"==i&&g_Weapon>0&&g_WeaponPlus<5?(++g_WeaponPlus,t=!0):"remove"==i&&g_Weapon>0&&(g_Weapon=0,g_WeaponPlus=0,t=!0),t&&(UpdateBasic(),UpdateEqw(),ChangeUrl())):"armor"==r?(t=!1,"min"==i&&g_Armor>0&&g_ArmorPlus>0?(--g_ArmorPlus,t=!0):"add"==i&&g_Armor>0&&g_ArmorPlus<5?(++g_ArmorPlus,t=!0):"remove"==i&&g_Armor>0&&(g_Armor=0,g_ArmorPlus=0,t=!0),t&&(UpdateBasic(),UpdateEqa(),ChangeUrl())):"acc"==r&&"remove"==i&&g_Acc>0&&(g_Acc=0,UpdateBasic(),UpdateEqc(),ChangeUrl())});$(".qz-type-item").click(function(){g_QzSelType=parseInt($(this).attr("data-index"));UpdateQz()});$(".qz-lv-item").click(function(){-1!=g_SlotCur&&(g_SlotCur==g_SlotCount?g_QzSelMLv=parseInt($(this).attr("data-index")):g_QzSelLv=parseInt($(this).attr("data-index")),UpdateQz())});$(".qz-plus-item").click(function(){-1!=g_SlotCur&&g_SlotCur!=g_SlotCount&&(g_QzSelPlus=parseInt($(this).attr("data-index")),UpdateQz())});$(".weapon-type-item").click(function(){g_SlotCount+1==g_SlotCur&&(g_WeaponType=parseInt($(this).attr("data-index")),UpdateEq())});$(".armor-type-item").click(function(){g_SlotCount+2==g_SlotCur&&(g_ArmorType=parseInt($(this).attr("data-index")),UpdateEq())});$(".eq-rank-item").click(function(){g_SlotCur<g_SlotCount+1||g_SlotCur>g_SlotCount+3||(g_SlotCur==g_SlotCount+3?g_EqRankAcc=parseInt($(this).attr("data-index")):g_EqRank=parseInt($(this).attr("data-index")),UpdateEq())});$(".eq-plus-item").click(function(){g_SlotCur<g_SlotCount+1||g_SlotCur>g_SlotCount+2||(g_EqPlus=parseInt($(this).attr("data-index")),UpdateEq())});$(".lv-rank-item").click(function(){99==g_SlotCur&&(g_LvRank=parseInt($(this).attr("data-index")),UpdateLv())});$("#btnClear").mouseover(function(){g_PrevMQuartz=0;g_PrevMQuartzLv=0;for(var n=0;n<g_SlotCount;++n)g_PrevQuartz[n]=0,g_PrevQuartzPlus[n]=0;g_PrevWeapon=0;g_PrevWeaponPlus=0;g_PrevArmor=0;g_PrevArmorPlus=0;g_PrevAcc=0;g_PrevEnhWeapon=0;g_PrevEnhArmor=0;g_PrevCharRank=g_CharRank;g_PrevCharLv=g_CharLv;g_PrevCharClo=0;UpdateElemPreview()});$("#btnClear").mouseleave(function(){UpdateElemPreview(-1)});$("#btnClear").click(function(){ClearSlot();UpdateSlot();UpdateElem();ChangeUrl()});$("#divCharaSel").on("click","a",function(){var n=$(this).attr("data-index");n>=0&&n<g_ch.length&&(g_CharId=g_ch[n].id,ClearSlot(),UpdateChara(),ChangeUrl());$("#dlgCharaSel").modal("hide")});$("#divQz").on("mouseover","a",function(){if(-1!=g_SlotCur){var n=parseInt($(this).attr("data-index"));PreparePreview();g_SlotCur==g_SlotCount?(g_PrevMQuartz=g_mq[n].id,g_PrevMQuartzLv=g_QzSelMLv):(g_PrevQuartz[g_SlotCur]=g_qu[n].id,g_PrevQuartzPlus[g_SlotCur]=g_QzSelPlus);UpdateElemPreview(n);g_SlotCur==g_SlotCount?$("#divDesc").html(GenMqDesc(n,g_QzSelMLv)):$("#divDesc").html(g_qs[n].lv[g_QzSelPlus].desc)}});$("#divQz").on("mouseleave","a",function(){-1!=g_SlotCur&&(UpdateElemPreview(-1),$("#divDesc").html(""))});$("#divQz").on("click","a",function(){if(-1!=g_SlotCur){var n=$(this).attr("data-index");g_SlotCur==g_SlotCount?(g_MQuartz=g_mq[n].id,g_MQuartzLv=g_QzSelMLv):(g_Quartz[g_SlotCur]=g_qu[n].id,g_QuartzPlus[g_SlotCur]=g_QzSelPlus);UpdateSlotDisplay(g_SlotCur);UpdateElem();ChangeUrl()}});$("#divEq").on("mouseover","a",function(){var t=g_SlotCur-(g_SlotCount+1),n;t<0||t>2||(PreparePreview(),n=$(this).attr("data-index"),0==t?($("#divDesc").html(GenEqwDesc(n,g_EqPlus)),g_PrevWeapon=g_eqw[n].id,g_PrevWeaponPlus=g_EqPlus,UpdatePrevBasic()):1==t?($("#divDesc").html(GenEqStr(g_eqa[n],g_EqPlus)),g_PrevArmor=g_eqa[n].id,g_PrevArmorPlus=g_EqPlus,UpdatePrevBasic()):2==t&&($("#divDesc").html(GenEqcDesc(n)),g_PrevAcc=g_eqc[n].id,UpdatePrevBasic()))});$("#divEq").on("mouseleave","a",function(){var n=g_SlotCur-(g_SlotCount+1);n<0||n>2||($("#divDesc").html(""),UpdateBasic())});$("#divEq").on("click","a",function(){var n=g_SlotCur-(g_SlotCount+1),t;n<0||n>2||(t=$(this).attr("data-index"),0==n?(g_Weapon=g_eqw[t].id,g_WeaponPlus=g_EqPlus,UpdateBasic(),UpdateEqw(),ChangeUrl()):1==n?(g_Armor=g_eqa[t].id,g_ArmorPlus=g_EqPlus,UpdateBasic(),UpdateEqa(),ChangeUrl()):2==n&&(g_Acc=g_eqc[t].id,UpdateBasic(),UpdateEqc(),ChangeUrl()))});$("#divEnh").on("mouseover","a",function(){var t=g_SlotCur-(g_SlotCount+1),n;t<3||t>4||(PreparePreview(),n=$(this).attr("data-index"),3==t?($("#divDesc").html(GenEnwDesc(n)),g_PrevEnhWeapon=n,UpdatePrevBasic()):4==t&&($("#divDesc").html(GenEnaDesc(n)),g_PrevEnhArmor=n,UpdatePrevBasic()))});$("#divEnh").on("mouseleave","a",function(){var n=g_SlotCur-(g_SlotCount+1);n<3||n>4||($("#divDesc").html(""),UpdateBasic())});$("#divEnh").on("click","a",function(){var n=g_SlotCur-(g_SlotCount+1),t;n<3||n>4||(t=$(this).attr("data-index"),3==n?(g_EnhWeapon=t,UpdateBasic(),UpdateEnw(),ChangeUrl()):4==n&&(g_EnhArmor=t,UpdateBasic(),UpdateEna(),ChangeUrl()))});$("#divLv").on("mouseover","a",function(){if(99==g_SlotCur){var n=$(this).attr("data-index");PreparePreview();g_PrevCharRank=g_LvRank;g_PrevCharLv=n;UpdatePrevBasic()}});$("#divLv").on("mouseleave","a",function(){99==g_SlotCur&&UpdateBasic()});$("#divLv").on("click","a",function(){if(99==g_SlotCur){var n=$(this).attr("data-index");g_CharRank=g_LvRank;g_CharLv=n;UpdateBasic();UpdateLvDisp();ChangeUrl()}});$("#divClo").on("mouseover","a",function(){var t=g_SlotCur-(g_SlotCount+1),n;5==t&&(n=$(this).attr("data-index"),PreparePreview(),g_PrevCharClo=n,UpdatePrevBasic())});$("#divClo").on("mouseleave","a",function(){var n=g_SlotCur-(g_SlotCount+1);5==n&&UpdateBasic()});$("#divClo").on("click","a",function(){var t=g_SlotCur-(g_SlotCount+1),n;5==t&&(n=$(this).attr("data-index"),g_CharClo=n,UpdateBasic(),UpdateClo(),ChangeUrl())});$(window).on("popstate",function(n){var t=n.originalEvent.state;(null==t||0==DecodeUrl(t.cdata))&&ClearSlot();g_SlotCur=-1;UpdatePanel(-1);UpdateChara()});$(document).ready(function(){for(var n,r,t,i,u=0;u<g_LineCount;++u)$(g_Line[u]).find(".orb-line").addClass("orb-line-color-"+u);for(InitArt(),InitArtAll(),n="",r=0;r<10;++r){for(t=0;t<10;++t)n+='<a class="btn btn-default btn-xs enh-item rank'+((r>>1)+1)+'" style="width: 20%;" data-index="'+(r*10+t)+'">',n+=g_rome[r],t>0&&(n+="+"+t),n+="<\/a>",4==t&&(n+="<br/>");n+="<br />"}for($("#divEnh").html(n),n="",i=1;i<=40;++i)i==31&&(n+='<div id="divLv6">'),n+='<a class="btn btn-default btn-xs" style="width: 20%;" data-index="'+i+'">'+i+"<\/a>",0==i%5&&(n+="<br/>");n+="<\/div>";$("#divLv").html(n);Init();UpdateCharaSel();g_data&&g_data.length>0?DecodeUrl(g_data)||UpdateChara():UpdateChara()});